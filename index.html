<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keuangan Keluarga Plus</title>
    <script src="https://unpkg.com/vue@3"></script>
    <style>
        /* Previous styles remain the same, adding new styles for new features */
        
        /* New styles for additional features */
        .feature-tabs {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .feature-tab {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .feature-tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 500;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            margin-left: 5px;
        }
        
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-completed {
            background-color: #e2e3e5;
            color: #383d41;
        }
        
        .interest-rate {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .progress-container {
            margin-top: 10px;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }
        
        .asset-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid;
        }
        
        .asset-savings {
            border-left-color: #28a745;
        }
        
        .asset-investment {
            border-left-color: #007bff;
        }
        
        .asset-debt {
            border-left-color: #dc3545;
        }
        
        .asset-value {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .asset-details {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .payment-history {
            margin-top: 10px;
            font-size: 0.8rem;
        }
        
        .payment-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        /* Add to existing media queries */
        @media (max-width: 480px) {
            .feature-tabs {
                overflow-x: auto;
                white-space: nowrap;
                padding-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <!-- Header -->
            <div class="header">
                <h1>üí∞ Keuangan Keluarga Plus</h1>
                <p>Kelola keuangan keluarga dengan fitur lengkap</p>
            </div>

            <!-- Navigation Tabs -->
            <div class="nav-tabs">
                <button class="nav-tab" :class="{ active: activeTab === 'dashboard' }" @click="activeTab = 'dashboard'">
                    üìä Dashboard
                </button>
                <button class="nav-tab" :class="{ active: activeTab === 'transactions' }" @click="activeTab = 'transactions'">
                    üìù Transaksi
                </button>
                <button class="nav-tab" :class="{ active: activeTab === 'budget' }" @click="activeTab = 'budget'">
                    üí° Budget
                </button>
                <button class="nav-tab" :class="{ active: activeTab === 'reports' }" @click="activeTab = 'reports'">
                    üìà Laporan
                </button>
                <button class="nav-tab" :class="{ active: activeTab === 'advanced' }" @click="activeTab = 'advanced'">
                    üöÄ Fitur Lanjutan
                </button>
            </div>

            <!-- Previous tabs content remains the same until Advanced Tab -->

            <!-- Advanced Tab -->
            <div v-show="activeTab === 'advanced'" class="tab-content">
                <div class="feature-tabs">
                    <div class="feature-tab" :class="{ active: activeFeature === 'recurring' }" @click="activeFeature = 'recurring'">
                        üîÑ Berulang
                    </div>
                    <div class="feature-tab" :class="{ active: activeFeature === 'goals' }" @click="activeFeature = 'goals'">
                        üéØ Target
                    </div>
                    <div class="feature-tab" :class="{ active: activeFeature === 'debts' }" @click="activeFeature = 'debts'">
                        üí≥ Hutang
                    </div>
                    <div class="feature-tab" :class="{ active: activeFeature === 'investments' }" @click="activeFeature = 'investments'">
                        üìà Investasi
                    </div>
                </div>

                <!-- Recurring Payments -->
                <div v-show="activeFeature === 'recurring'">
                    <div class="card">
                        <h3>Pembayaran Berulang</h3>
                        <button class="btn btn-primary" @click="openRecurringModal" style="margin-bottom: 15px;">
                            + Tambah Pembayaran Berulang
                        </button>
                        
                        <div v-if="recurringPayments.length > 0">
                            <div class="transaction-item" v-for="payment in recurringPayments" :key="payment.id">
                                <div class="transaction-info">
                                    <h4>{{ payment.description }}
                                        <span class="status-badge" :class="getRecurringStatusClass(payment)">
                                            {{ getRecurringStatusText(payment) }}
                                        </span>
                                    </h4>
                                    <p>{{ payment.category }} ‚Ä¢ 
                                        {{ formatFrequency(payment.frequency) }} ‚Ä¢ 
                                        Rp{{ formatCurrency(payment.amount) }}
                                    </p>
                                    <p class="asset-details">
                                        Mulai: {{ formatDate(payment.startDate) }} ‚Ä¢ 
                                        Berakhir: {{ payment.endDate ? formatDate(payment.endDate) : 'Tidak ada' }}
                                    </p>
                                </div>
                                <div class="transaction-actions">
                                    <button class="btn btn-warning btn-sm" @click="editRecurringPayment(payment)">‚úèÔ∏è</button>
                                    <button class="btn btn-danger btn-sm" @click="deleteRecurringPayment(payment.id)">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>
                        <div v-else class="empty-state">
                            <div class="icon">üîÑ</div>
                            <p>Belum ada pembayaran berulang</p>
                        </div>
                    </div>
                </div>

                <!-- Financial Goals -->
                <div v-show="activeFeature === 'goals'">
                    <div class="card">
                        <h3>Target Keuangan</h3>
                        <button class="btn btn-primary" @click="openGoalModal" style="margin-bottom: 15px;">
                            + Tambah Target
                        </button>
                        
                        <div v-if="financialGoals.length > 0">
                            <div class="asset-card" v-for="goal in financialGoals" :key="goal.id">
                                <h4>{{ goal.name }}
                                    <span class="status-badge" :class="getGoalStatusClass(goal)">
                                        {{ getGoalStatusText(goal) }}
                                    </span>
                                </h4>
                                <div class="progress-container">
                                    <div class="progress-text">
                                        <span>Terkumpul: {{ formatCurrency(goal.saved) }}</span>
                                        <span>Target: {{ formatCurrency(goal.target) }}</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" :style="{ width: Math.min((goal.saved / goal.target) * 100, 100) + '%' }"></div>
                                    </div>
                                </div>
                                <p class="asset-details">
                                    Target tanggal: {{ formatDate(goal.targetDate) }} ‚Ä¢ 
                                    Prioritas: {{ goal.priority }}
                                </p>
                                <div class="transaction-actions" style="margin-top: 10px;">
                                    <button class="btn btn-success btn-sm" @click="addToGoal(goal)">‚ûï Tambah</button>
                                    <button class="btn btn-warning btn-sm" @click="editGoal(goal)">‚úèÔ∏è</button>
                                    <button class="btn btn-danger btn-sm" @click="deleteGoal(goal.id)">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>
                        <div v-else class="empty-state">
                            <div class="icon">üéØ</div>
                            <p>Belum ada target keuangan</p>
                        </div>
                    </div>
                </div>

                <!-- Debts and Loans -->
                <div v-show="activeFeature === 'debts'">
                    <div class="card">
                        <h3>Pinjaman & Hutang</h3>
                        <button class="btn btn-primary" @click="openDebtModal" style="margin-bottom: 15px;">
                            + Tambah Hutang/Pinjaman
                        </button>
                        
                        <div v-if="debts.length > 0">
                            <div class="asset-card" :class="debt.type === 'debt' ? 'asset-debt' : 'asset-savings'" v-for="debt in debts" :key="debt.id">
                                <h4>{{ debt.description }}</h4>
                                <div class="asset-value">
                                    {{ formatCurrency(debt.amount) }}
                                    <span class="interest-rate" v-if="debt.interestRate > 0">
                                        (Bunga {{ debt.interestRate }}% {{ debt.interestType === 'simple' ? 'sederhana' : 'majemuk' }})
                                    </span>
                                </div>
                                <p class="asset-details">
                                    {{ debt.type === 'debt' ? 'Hutang ke' : 'Pinjaman ke' }}: {{ debt.party }} ‚Ä¢ 
                                    Mulai: {{ formatDate(debt.startDate) }} ‚Ä¢ 
                                    Jatuh tempo: {{ formatDate(debt.endDate) }}
                                </p>
                                
                                <div class="payment-history" v-if="debt.payments.length > 0">
                                    <p><strong>Riwayat Pembayaran:</strong></p>
                                    <div class="payment-item" v-for="payment in debt.payments" :key="payment.date">
                                        <span>{{ formatDate(payment.date) }}</span>
                                        <span>{{ formatCurrency(payment.amount) }}</span>
                                    </div>
                                </div>
                                
                                <div class="transaction-actions" style="margin-top: 10px;">
                                    <button class="btn btn-success btn-sm" @click="recordDebtPayment(debt)">üí≥ Bayar</button>
                                    <button class="btn btn-warning btn-sm" @click="editDebt(debt)">‚úèÔ∏è</button>
                                    <button class="btn btn-danger btn-sm" @click="deleteDebt(debt.id)">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>
                        <div v-else class="empty-state">
                            <div class="icon">üí≥</div>
                            <p>Belum ada catatan hutang/pinjaman</p>
                        </div>
                    </div>
                </div>

                <!-- Investments -->
                <div v-show="activeFeature === 'investments'">
                    <div class="card">
                        <h3>Investasi & Aset</h3>
                        <button class="btn btn-primary" @click="openInvestmentModal" style="margin-bottom: 15px;">
                            + Tambah Investasi
                        </button>
                        
                        <div v-if="investments.length > 0">
                            <div class="asset-card asset-investment" v-for="investment in investments" :key="investment.id">
                                <h4>{{ investment.name }} ({{ investment.type }})</h4>
                                <div class="asset-value">
                                    Nilai Saat Ini: {{ formatCurrency(investment.currentValue) }}
                                    <span v-if="investment.initialValue" class="interest-rate">
                                        (ROI: {{ calculateROI(investment) }}%)
                                    </span>
                                </div>
                                <p class="asset-details">
                                    Dimulai: {{ formatDate(investment.startDate) }} ‚Ä¢ 
                                    Jumlah Unit: {{ investment.units || '-' }} ‚Ä¢ 
                                    Biaya: {{ formatCurrency(investment.fees || 0) }}
                                </p>
                                <p v-if="investment.notes" class="asset-details">
                                    Catatan: {{ investment.notes }}
                                </p>
                                
                                <div class="transaction-actions" style="margin-top: 10px;">
                                    <button class="btn btn-success btn-sm" @click="updateInvestmentValue(investment)">üîÑ Update Nilai</button>
                                    <button class="btn btn-warning btn-sm" @click="editInvestment(investment)">‚úèÔ∏è</button>
                                    <button class="btn btn-danger btn-sm" @click="deleteInvestment(investment.id)">üóëÔ∏è</button>
                                </div>
                            </div>
                        </div>
                        <div v-else class="empty-state">
                            <div class="icon">üìà</div>
                            <p>Belum ada catatan investasi</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Previous content remains the same until modals -->

            <!-- New Modals for Advanced Features -->
            
            <!-- Recurring Payment Modal -->
            <div v-if="showRecurringModal" class="modal" @click="closeRecurringModal">
                <div class="modal-content" @click.stop>
                    <div class="modal-header">
                        <h3 class="modal-title">
                            {{ editingRecurring ? 'Edit Pembayaran Berulang' : 'Tambah Pembayaran Berulang' }}
                        </h3>
                        <button class="close-btn" @click="closeRecurringModal">&times;</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Deskripsi</label>
                        <input v-model="recurringForm.description" type="text" class="form-control" placeholder="Contoh: Langganan Netflix">
                    </div>
                    
                    <div class="form-group">
                        <label>Kategori</label>
                        <select v-model="recurringForm.category" class="form-control">
                            <option value="">Pilih Kategori</option>
                            <option v-for="category in expenseCategories" :key="category">{{ category }}</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jumlah</label>
                            <input v-model.number="recurringForm.amount" type="number" class="form-control" placeholder="Rp">
                        </div>
                        <div class="form-group">
                            <label>Frekuensi</label>
                            <select v-model="recurringForm.frequency" class="form-control">
                                <option value="daily">Harian</option>
                                <option value="weekly">Mingguan</option>
                                <option value="monthly">Bulanan</option>
                                <option value="yearly">Tahunan</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Mulai Tanggal</label>
                            <input v-model="recurringForm.startDate" type="date" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Tanggal Berakhir (opsional)</label>
                            <input v-model="recurringForm.endDate" type="date" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" @click="saveRecurringPayment" style="width: 100%;">
                            {{ editingRecurring ? 'Update' : 'Simpan' }}
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Financial Goal Modal -->
            <div v-if="showGoalModal" class="modal" @click="closeGoalModal">
                <div class="modal-content" @click.stop>
                    <div class="modal-header">
                        <h3 class="modal-title">
                            {{ editingGoal ? 'Edit Target Keuangan' : 'Tambah Target Keuangan' }}
                        </h3>
                        <button class="close-btn" @click="closeGoalModal">&times;</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Nama Target</label>
                        <input v-model="goalForm.name" type="text" class="form-control" placeholder="Contoh: DP Rumah">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Target Jumlah</label>
                            <input v-model.number="goalForm.target" type="number" class="form-control" placeholder="Rp">
                        </div>
                        <div class="form-group">
                            <label>Terkumpul</label>
                            <input v-model.number="goalForm.saved" type="number" class="form-control" placeholder="Rp">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Target Tanggal</label>
                            <input v-model="goalForm.targetDate" type="date" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Prioritas</label>
                            <select v-model="goalForm.priority" class="form-control">
                                <option value="low">Rendah</option>
                                <option value="medium">Sedang</option>
                                <option value="high">Tinggi</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Catatan (opsional)</label>
                        <textarea v-model="goalForm.notes" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" @click="saveGoal" style="width: 100%;">
                            {{ editingGoal ? 'Update' : 'Simpan' }}
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Debt/Loan Modal -->
            <div v-if="showDebtModal" class="modal" @click="closeDebtModal">
                <div class="modal-content" @click.stop>
                    <div class="modal-header">
                        <h3 class="modal-title">
                            {{ editingDebt ? 'Edit Hutang/Pinjaman' : 'Tambah Hutang/Pinjaman' }}
                        </h3>
                        <button class="close-btn" @click="closeDebtModal">&times;</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Jenis</label>
                        <select v-model="debtForm.type" class="form-control">
                            <option value="debt">Hutang (Saya berhutang)</option>
                            <option value="loan">Pinjaman (Saya meminjamkan)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Deskripsi</label>
                        <input v-model="debtForm.description" type="text" class="form-control" placeholder="Contoh: Pinjaman Bank ABC">
                    </div>
                    
                    <div class="form-group">
                        <label>{{ debtForm.type === 'debt' ? 'Pemberi Hutang' : 'Peminjam' }}</label>
                        <input v-model="debtForm.party" type="text" class="form-control" placeholder="Nama bank/orang">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jumlah</label>
                            <input v-model.number="debtForm.amount" type="number" class="form-control" placeholder="Rp">
                        </div>
                        <div class="form-group">
                            <label>Bunga (%)</label>
                            <input v-model.number="debtForm.interestRate" type="number" class="form-control" placeholder="0 jika tidak ada">
                        </div>
                    </div>
                    
                    <div class="form-group" v-if="debtForm.interestRate > 0">
                        <label>Jenis Bunga</label>
                        <select v-model="debtForm.interestType" class="form-control">
                            <option value="simple">Sederhana</option>
                            <option value="compound">Majemuk</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Tanggal Mulai</label>
                            <input v-model="debtForm.startDate" type="date" class="form-control">
                        </div>
                        <div class="form-group">
                            <label>Tanggal Jatuh Tempo</label>
                            <input v-model="debtForm.endDate" type="date" class="form-control">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Catatan (opsional)</label>
                        <textarea v-model="debtForm.notes" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" @click="saveDebt" style="width: 100%;">
                            {{ editingDebt ? 'Update' : 'Simpan' }}
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Debt Payment Modal -->
            <div v-if="showDebtPaymentModal" class="modal" @click="closeDebtPaymentModal">
                <div class="modal-content" @click.stop>
                    <div class="modal-header">
                        <h3 class="modal-title">
                            Catat Pembayaran Hutang
                        </h3>
                        <button class="close-btn" @click="closeDebtPaymentModal">&times;</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Tanggal Pembayaran</label>
                        <input v-model="debtPaymentForm.date" type="date" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Jumlah Pembayaran</label>
                        <input v-model.number="debtPaymentForm.amount" type="number" class="form-control" placeholder="Rp">
                    </div>
                    
                    <div class="form-group">
                        <label>Metode Pembayaran</label>
                        <input v-model="debtPaymentForm.method" type="text" class="form-control" placeholder="Contoh: Transfer Bank">
                    </div>
                    
                    <div class="form-group">
                        <label>Catatan (opsional)</label>
                        <textarea v-model="debtPaymentForm.notes" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" @click="recordPayment" style="width: 100%;">
                            Catat Pembayaran
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Investment Modal -->
            <div v-if="showInvestmentModal" class="modal" @click="closeInvestmentModal">
                <div class="modal-content" @click.stop>
                    <div class="modal-header">
                        <h3 class="modal-title">
                            {{ editingInvestment ? 'Edit Investasi' : 'Tambah Investasi' }}
                        </h3>
                        <button class="close-btn" @click="closeInvestmentModal">&times;</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Nama Investasi</label>
                        <input v-model="investmentForm.name" type="text" class="form-control" placeholder="Contoh: Saham BBCA">
                    </div>
                    
                    <div class="form-group">
                        <label>Jenis Investasi</label>
                        <select v-model="investmentForm.type" class="form-control">
                            <option value="saham">Saham</option>
                            <option value="reksadana">Reksadana</option>
                            <option value="emas">Emas</option>
                            <option value="deposito">Deposito</option>
                            <option value="property">Properti</option>
                            <option value="lainnya">Lainnya</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Nilai Awal</label>
                            <input v-model.number="investmentForm.initialValue" type="number" class="form-control" placeholder="Rp">
                        </div>
                        <div class="form-group">
                            <label>Nilai Saat Ini</label>
                            <input v-model.number="investmentForm.currentValue" type="number" class="form-control" placeholder="Rp">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Jumlah Unit</label>
                            <input v-model.number="investmentForm.units" type="number" class="form-control" placeholder="Contoh: 100 lembar">
                        </div>
                        <div class="form-group">
                            <label>Biaya (opsional)</label>
                            <input v-model.number="investmentForm.fees" type="number" class="form-control" placeholder="Rp">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Tanggal Mulai</label>
                        <input v-model="investmentForm.startDate" type="date" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Catatan (opsional)</label>
                        <textarea v-model="investmentForm.notes" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" @click="saveInvestment" style="width: 100%;">
                            {{ editingInvestment ? 'Update' : 'Simpan' }}
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Value Update Modal for Investments -->
            <div v-if="showValueUpdateModal" class="modal" @click="closeValueUpdateModal">
                <div class="modal-content" @click.stop>
                    <div class="modal-header">
                        <h3 class="modal-title">
                            Update Nilai Investasi
                        </h3>
                        <button class="close-btn" @click="closeValueUpdateModal">&times;</button>
                    </div>
                    
                    <div class="form-group">
                        <label>Nilai Saat Ini</label>
                        <input v-model.number="valueUpdateForm.currentValue" type="number" class="form-control" placeholder="Rp">
                    </div>
                    
                    <div class="form-group">
                        <label>Tanggal Update</label>
                        <input v-model="valueUpdateForm.updateDate" type="date" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label>Catatan Perubahan (opsional)</label>
                        <textarea v-model="valueUpdateForm.notes" class="form-control" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <button class="btn btn-primary" @click="updateInvestment" style="width: 100%;">
                            Update Nilai
                        </button>
                    </div>
                </div>
            </div>

            <!-- Previous modals remain the same -->
            
            <!-- Floating Add Button - Updated to show context-aware actions -->
            <button class="floating-btn" @click="contextualAddAction">
                {{ activeTab === 'advanced' ? 'üí°' : '+' }}
            </button>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    // Previous data properties remain the same
                    
                    // New data properties for advanced features
                    activeFeature: 'recurring',
                    showRecurringModal: false,
                    showGoalModal: false,
                    showDebtModal: false,
                    showDebtPaymentModal: false,
                    showInvestmentModal: false,
                    showValueUpdateModal: false,
                    editingRecurring: null,
                    editingGoal: null,
                    editingDebt: null,
                    editingInvestment: null,
                    selectedDebt: null,
                    selectedInvestment: null,
                    
                    recurringForm: {
                        description: '',
                        category: '',
                        amount: null,
                        frequency: 'monthly',
                        startDate: new Date().toISOString().split('T')[0],
                        endDate: ''
                    },
                    
                    goalForm: {
                        name: '',
                        target: null,
                        saved: null,
                        targetDate: '',
                        priority: 'medium',
                        notes: ''
                    },
                    
                    debtForm: {
                        type: 'debt',
                        description: '',
                        party: '',
                        amount: null,
                        interestRate: 0,
                        interestType: 'simple',
                        startDate: new Date().toISOString().split('T')[0],
                        endDate: '',
                        notes: '',
                        payments: []
                    },
                    
                    debtPaymentForm: {
                        date: new Date().toISOString().split('T')[0],
                        amount: null,
                        method: '',
                        notes: ''
                    },
                    
                    investmentForm: {
                        name: '',
                        type: 'saham',
                        initialValue: null,
                        currentValue: null,
                        units: null,
                        fees: null,
                        startDate: new Date().toISOString().split('T')[0],
                        notes: ''
                    },
                    
                    valueUpdateForm: {
                        currentValue: null,
                        updateDate: new Date().toISOString().split('T')[0],
                        notes: ''
                    },
                    
                    recurringPayments: JSON.parse(localStorage.getItem('recurringPayments') || '[]'),
                    financialGoals: JSON.parse(localStorage.getItem('financialGoals') || '[]'),
                    debts: JSON.parse(localStorage.getItem('debts') || '[]'),
                    investments: JSON.parse(localStorage.getItem('investments') || '[]')
                };
            },
            computed: {
                // Previous computed properties remain the same
                
                // New computed properties for advanced features
                upcomingRecurringPayments() {
                    const today = new Date().toISOString().split('T')[0];
                    return this.recurringPayments.filter(payment => {
                        return (!payment.endDate || payment.endDate >= today) && 
                               payment.startDate <= today;
                    });
                },
                
                activeGoals() {
                    return this.financialGoals.filter(goal => {
                        const today = new Date();
                        const targetDate = new Date(goal.targetDate);
                        return goal.saved < goal.target && targetDate > today;
                    });
                },
                
                overdueDebts() {
                    const today = new Date().toISOString().split('T')[0];
                    return this.debts.filter(debt => {
                        return debt.endDate < today && 
                               debt.payments.reduce((sum, p) => sum + p.amount, 0) < debt.amount;
                    });
                }
            },
            methods: {
                // Previous methods remain the same
                
                // New methods for advanced features
                
                // Recurring Payments
                openRecurringModal() {
                    this.showRecurringModal = true;
                    this.editingRecurring = null;
                    this.recurringForm = {
                        description: '',
                        category: '',
                        amount: null,
                        frequency: 'monthly',
                        startDate: new Date().toISOString().split('T')[0],
                        endDate: ''
                    };
                },
                
                editRecurringPayment(payment) {
                    this.editingRecurring = payment;
                    this.recurringForm = { ...payment };
                    this.showRecurringModal = true;
                },
                
                closeRecurringModal() {
                    this.showRecurringModal = false;
                },
                
                saveRecurringPayment() {
                    if (!this.recurringForm.description || !this.recurringForm.category || 
                        !this.recurringForm.amount || !this.recurringForm.startDate) {
                        alert('Mohon lengkapi semua field yang diperlukan!');
                        return;
                    }
                    
                    if (this.editingRecurring) {
                        const index = this.recurringPayments.findIndex(p => p.id === this.editingRecurring.id);
                        if (index !== -1) {
                            this.recurringPayments[index] = {
                                ...this.editingRecurring,
                                ...this.recurringForm
                            };
                        }
                    } else {
                        this.recurringPayments.push({
                            id: Date.now(),
                            ...this.recurringForm
                        });
                    }
                    
                    this.saveAdvancedData();
                    this.closeRecurringModal();
                },
                
                deleteRecurringPayment(id) {
                    if (confirm('Apakah Anda yakin ingin menghapus pembayaran berulang ini?')) {
                        this.recurringPayments = this.recurringPayments.filter(p => p.id !== id);
                        this.saveAdvancedData();
                    }
                },
                
                getRecurringStatusClass(payment) {
                    const today = new Date().toISOString().split('T')[0];
                    if (payment.endDate && payment.endDate < today) {
                        return 'status-completed';
                    }
                    return 'status-active';
                },
                
                getRecurringStatusText(payment) {
                    const today = new Date().toISOString().split('T')[0];
                    if (payment.endDate && payment.endDate < today) {
                        return 'Selesai';
                    }
                    return 'Aktif';
                },
                
                formatFrequency(freq) {
                    const map = {
                        daily: 'Harian',
                        weekly: 'Mingguan',
                        monthly: 'Bulanan',
                        yearly: 'Tahunan'
                    };
                    return map[freq] || freq;
                },
                
                // Financial Goals
                openGoalModal() {
                    this.showGoalModal = true;
                    this.editingGoal = null;
                    this.goalForm = {
                        name: '',
                        target: null,
                        saved: null,
                        targetDate: '',
                        priority: 'medium',
                        notes: ''
                    };
                },
                
                editGoal(goal) {
                    this.editingGoal = goal;
                    this.goalForm = { ...goal };
                    this.showGoalModal = true;
                },
                
                closeGoalModal() {
                    this.showGoalModal = false;
                },
                
                saveGoal() {
                    if (!this.goalForm.name || !this.goalForm.target || 
                        !this.goalForm.targetDate) {
                        alert('Mohon lengkapi semua field yang diperlukan!');
                        return;
                    }
                    
                    if (this.editingGoal) {
                        const index = this.financialGoals.findIndex(g => g.id === this.editingGoal.id);
                        if (index !== -1) {
                            this.financialGoals[index] = {
                                ...this.editingGoal,
                                ...this.goalForm
                            };
                        }
                    } else {
                        this.financialGoals.push({
                            id: Date.now(),
                            ...this.goalForm,
                            saved: this.goalForm.saved || 0
                        });
                    }
                    
                    this.saveAdvancedData();
                    this.closeGoalModal();
                },
                
                deleteGoal(id) {
                    if (confirm('Apakah Anda yakin ingin menghapus target ini?')) {
                        this.financialGoals = this.financialGoals.filter(g => g.id !== id);
                        this.saveAdvancedData();
                    }
                },
                
                addToGoal(goal) {
                    const amount = prompt(`Masukkan jumlah yang ingin ditambahkan ke target "${goal.name}":`);
                    if (amount && !isNaN(amount)) {
                        const numAmount = parseFloat(amount);
                        goal.saved += numAmount;
                        this.saveAdvancedData();
                        
                        // Optionally create a transaction for this
                        this.transactions.push({
                            id: Date.now(),
                            date: new Date().toISOString().split('T')[0],
                            description: `Tabungan untuk ${goal.name}`,
                            category: 'Tabungan',
                            amount: numAmount,
                            type: 'expense'
                        });
                        this.saveData();
                    }
                },
                
                getGoalStatusClass(goal) {
                    const today = new Date();
                    const targetDate = new Date(goal.targetDate);
                    
                    if (goal.saved >= goal.target) {
                        return 'status-completed';
                    } else if (targetDate < today) {
                        return 'status-pending';
                    }
                    return 'status-active';
                },
                
                getGoalStatusText(goal) {
                    const today = new Date();
                    const targetDate = new Date(goal.targetDate);
                    
                    if (goal.saved >= goal.target) {
                        return 'Tercapai';
                    } else if (targetDate < today) {
                        return 'Terlewat';
                    }
                    
                    const percent = Math.round((goal.saved / goal.target) * 100);
                    return `${percent}%`;
                },
                
                // Debts and Loans
                openDebtModal() {
                    this.showDebtModal = true;
                    this.editingDebt = null;
                    this.debtForm = {
                        type: 'debt',
                        description: '',
                        party: '',
                        amount: null,
                        interestRate: 0,
                        interestType: 'simple',
                        startDate: new Date().toISOString().split('T')[0],
                        endDate: '',
                        notes: '',
                        payments: []
                    };
                },
                
                editDebt(debt) {
                    this.editingDebt = debt;
                    this.debtForm = { ...debt };
                    this.showDebtModal = true;
                },
                
                closeDebtModal() {
                    this.showDebtModal = false;
                },
                
                saveDebt() {
                    if (!this.debtForm.description || !this.debtForm.party || 
                        !this.debtForm.amount || !this.debtForm.startDate || 
                        !this.debtForm.endDate) {
                        alert('Mohon lengkapi semua field yang diperlukan!');
                        return;
                    }
                    
                    if (this.editingDebt) {
                        const index = this.debts.findIndex(d => d.id === this.editingDebt.id);
                        if (index !== -1) {
                            this.debts[index] = {
                                ...this.editingDebt,
                                ...this.debtForm
                            };
                        }
                    } else {
                        this.debts.push({
                            id: Date.now(),
                            ...this.debtForm,
                            payments: []
                        });
                    }
                    
                    this.saveAdvancedData();
                    this.closeDebtModal();
                },
                
                deleteDebt(id) {
                    if (confirm('Apakah Anda yakin ingin menghapus catatan hutang/pinjaman ini?')) {
                        this.debts = this.debts.filter(d => d.id !== id);
                        this.saveAdvancedData();
                    }
                },
                
                recordDebtPayment(debt) {
                    this.selectedDebt = debt;
                    this.debtPaymentForm = {
                        date: new Date().toISOString().split('T')[0],
                        amount: null,
                        method: '',
                        notes: ''
                    };
                    this.showDebtPaymentModal = true;
                },
                
                closeDebtPaymentModal() {
                    this.showDebtPaymentModal = false;
                },
                
                recordPayment() {
                    if (!this.debtPaymentForm.date || !this.debtPaymentForm.amount) {
                        alert('Mohon isi tanggal dan jumlah pembayaran!');
                        return;
                    }
                    
                    const debtIndex = this.debts.findIndex(d => d.id === this.selectedDebt.id);
                    if (debtIndex !== -1) {
                        this.debts[debtIndex].payments.push({
                            ...this.debtPaymentForm
                        });
                        this.saveAdvancedData();
                        
                        // Create a transaction for this payment
                        const transactionType = this.selectedDebt.type === 'debt' ? 'expense' : 'income';
                        this.transactions.push({
                            id: Date.now(),
                            date: this.debtPaymentForm.date,
                            description: `Pembayaran ${this.selectedDebt.description}`,
                            category: 'Cicilan',
                            amount: parseFloat(this.debtPaymentForm.amount),
                            type: transactionType
                        });
                        this.saveData();
                    }
                    
                    this.closeDebtPaymentModal();
                },
                
                calculateDebt(debt) {
                    if (debt.interestRate <= 0) {
                        return debt.amount;
                    }
                    
                    const startDate = new Date(debt.startDate);
                    const endDate = new Date(debt.endDate);
                    const years = (endDate - startDate) / (1000 * 60 * 60 * 24 * 365);
                    
                    if (debt.interestType === 'simple') {
                        return debt.amount * (1 + (debt.interestRate / 100) * years);
                    } else {
                        // Compound interest
                        return debt.amount * Math.pow(1 + (debt.interestRate / 100), years);
                    }
                },
                
                // Investments
                openInvestmentModal() {
                    this.showInvestmentModal = true;
                    this.editingInvestment = null;
                    this.investmentForm = {
                        name: '',
                        type: 'saham',
                        initialValue: null,
                        currentValue: null,
                        units: null,
                        fees: null,
                        startDate: new Date().toISOString().split('T')[0],
                        notes: ''
                    };
                },
                
                editInvestment(investment) {
                    this.editingInvestment = investment;
                    this.investmentForm = { ...investment };
                    this.showInvestmentModal = true;
                },
                
                closeInvestmentModal() {
                    this.showInvestmentModal = false;
                },
                
                saveInvestment() {
                    if (!this.investmentForm.name || !this.investmentForm.type || 
                        !this.investmentForm.currentValue || !this.investmentForm.startDate) {
                        alert('Mohon lengkapi semua field yang diperlukan!');
                        return;
                    }
                    
                    if (this.editingInvestment) {
                        const index = this.investments.findIndex(i => i.id === this.editingInvestment.id);
                        if (index !== -1) {
                            this.investments[index] = {
                                ...this.editingInvestment,
                                ...this.investmentForm
                            };
                        }
                    } else {
                        this.investments.push({
                            id: Date.now(),
                            ...this.investmentForm,
                            initialValue: this.investmentForm.initialValue || this.investmentForm.currentValue
                        });
                    }
                    
                    this.saveAdvancedData();
                    this.closeInvestmentModal();
                },
                
                deleteInvestment(id) {
                    if (confirm('Apakah Anda yakin ingin menghapus investasi ini?')) {
                        this.investments = this.investments.filter(i => i.id !== id);
                        this.saveAdvancedData();
                    }
                },
                
                updateInvestmentValue(investment) {
                    this.selectedInvestment = investment;
                    this.valueUpdateForm = {
                        currentValue: investment.currentValue,
                        updateDate: new Date().toISOString().split('T')[0],
                        notes: ''
                    };
                    this.showValueUpdateModal = true;
                },
                
                closeValueUpdateModal() {
                    this.showValueUpdateModal = false;
                },
                
                updateInvestment() {
                    if (!this.valueUpdateForm.currentValue) {
                        alert('Mohon masukkan nilai saat ini!');
                        return;
                    }
                    
                    const index = this.investments.findIndex(i => i.id === this.selectedInvestment.id);
                    if (index !== -1) {
                        this.investments[index].currentValue = parseFloat(this.valueUpdateForm.currentValue);
                        this.saveAdvancedData();
                        
                        // Add a note about the update if provided
                        if (this.valueUpdateForm.notes) {
                            if (!this.investments[index].notes) {
                                this.investments[index].notes = '';
                            }
                            this.investments[index].notes += `\nUpdate ${this.valueUpdateForm.updateDate}: ${this.valueUpdateForm.notes}`;
                        }
                    }
                    
                    this.closeValueUpdateModal();
                },
                
                calculateROI(investment) {
                    if (!investment.initialValue || investment.initialValue === 0) {
                        return 0;
                    }
                    return Math.round(((investment.currentValue - investment.initialValue) / investment.initialValue) * 100);
                },
                
                // Contextual add action for floating button
                contextualAddAction() {
                    if (this.activeTab === 'advanced') {
                        switch (this.activeFeature) {
                            case 'recurring':
                                this.openRecurringModal();
                                break;
                            case 'goals':
                                this.openGoalModal();
                                break;
                            case 'debts':
                                this.openDebtModal();
                                break;
                            case 'investments':
                                this.openInvestmentModal();
                                break;
                            default:
                                this.openModal('expense');
                        }
                    } else {
                        this.openModal('expense');
                    }
                },
                
                // Save all advanced data
                saveAdvancedData() {
                    localStorage.setItem('recurringPayments', JSON.stringify(this.recurringPayments));
                    localStorage.setItem('financialGoals', JSON.stringify(this.financialGoals));
                    localStorage.setItem('debts', JSON.stringify(this.debts));
                    localStorage.setItem('investments', JSON.stringify(this.investments));
                },
                
                // Update export/import to include advanced data
                exportData() {
                    const data = {
                        transactions: this.transactions,
                        monthlyBudget: this.monthlyBudget,
                        recurringPayments: this.recurringPayments,
                        financialGoals: this.financialGoals,
                        debts: this.debts,
                        investments: this.investments
                    };
                    const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `keuangan-keluarga-plus-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                },
                
                importData(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = e => {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.transactions && Array.isArray(data.transactions)) {
                                this.transactions = data.transactions;
                                if (data.monthlyBudget) {
                                    this.monthlyBudget = data.monthlyBudget;
                                }
                                
                                // Import advanced data if available
                                if (data.recurringPayments) {
                                    this.recurringPayments = data.recurringPayments;
                                }
                                if (data.financialGoals) {
                                    this.financialGoals = data.financialGoals;
                                }
                                if (data.debts) {
                                    this.debts = data.debts;
                                }
                                if (data.investments) {
                                    this.investments = data.investments;
                                }
                                
                                this.saveData();
                                this.saveAdvancedData();
                                alert('Data berhasil diimpor!');
                            } else {
                                alert('Format file tidak valid!');
                            }
                        } catch (error) {
                            alert('Gagal memproses file: ' + error.message);
                        }
                        event.target.value = '';
                    };
                    reader.readAsText(file);
                }
            },
            mounted() {
                // Set default date to today
                this.form.date = new Date().toISOString().split('T')[0];
                
                // Check for upcoming recurring payments
                const today = new Date().toISOString().split('T')[0];
                const upcoming = this.recurringPayments.filter(payment => {
                    return (!payment.endDate || payment.endDate >= today) && 
                           payment.startDate <= today;
                });
                
                if (upcoming.length > 0) {
                    // You could add a notification here
                    console.log('Anda memiliki', upcoming.length, 'pembayaran berulang yang aktif');
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
